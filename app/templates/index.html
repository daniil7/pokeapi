{% extends "base.html" %}
{% block content %}

<div class="mt-2"
    x-data="{
        pokemons: [],

        async retrievePokemons() {
            this.pokemons = await (await fetch('/api/pokemon')).json();
        },

        search: '',

        doSearch() {
            return this.pokemons.filter((pokemon) => {
                return pokemon.name
                    .replace(/ /g, '')
                    .toLowerCase()
                    .includes(this.search.replace(/ /g, '').toLowerCase());
            });
        },

        paginated: [],
        current_page: 0,
        pages_count: 0,

        pagination(array, one_page_limit, page_num) {
            pages_count = Math.ceil(array.length / one_page_limit)
            paginated = array.slice(page_num*one_page_limit, (page_num+1)*one_page_limit)
            return [pages_count, paginated]
        },
        paginatePokemons() {
            [_pages_count, _paginated] = this.pagination(this.doSearch(), 20, this.current_page);
            this.pages_count = _pages_count;
            this.paginated = _paginated;
            return this.paginated;
        }
    }"
    x-init="
        await retrievePokemons();
    ">

    <div class="container mx-auto">
        <input
            x-ref="searchInput"
            x-model="search"
            x-on:keydown.window.prevent.slash="$refs.searchInput.focus()"
            placeholder="Ищем покемона..."
            type="search"
            class="block w-full rounded bg-gray-200 p-4 mb-4"
        />
        <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4">
            <template x-for="pokemon in paginatePokemons()" :key="pokemon.name">
                <div class="flex items-center shadow p-4">
                    <img class="rounded-full w-12 h-12" src="https://media.moddb.com/images/groups/1/3/2392/cat.jpg" />
                    <div class="ml-4">
                        <a x-bind:href="'/pokemon/'+pokemon.name"><span class="text-lg text-gray-900" x-text="pokemon.name"></span></a>
                    </div>
                </div>
            </template>
        </div>
        <div class="flex flex-wrap mt-4">
            <template x-for="page in pages_count">
                <div class="flex items-center justify-center border-solid border-2 border-indigo-600 p-2 mx-1 mb-1 min-w-[2.5rem] min-h-[2.5rem]"
                    x-text="page"
                    x-on:click="current_page = page"></div>
            </template>
        </div>
    </div>
</div>

{% endblock %}
